#!/usr/bin/perl -w

use strict;
use Proc::Daemon;
use Getopt::Long;

my $pidfile = '/var/run/filerd.pid';
GetOptions("pidfile=s" => \$pidfile);

my $daemon = Proc::Daemon->new( pid_file => $pidfile );

$daemon->Init;

chmod 0644, $pidfile;

my $continue = 1;
$SIG{'TERM'} = sub { $continue = 0 };

my $run_filer = 0;
$SIG{'HUP'} = sub { $run_filer = 1 };

while ($continue) {
    while ($run_filer) {
        $run_filer = 0;
        system('/usr/local/griidc/filer/filer');
    }
    sleep;
}
