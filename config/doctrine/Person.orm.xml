<!--
This file defines the Doctrine mapping between the Pelagos\Entity\Person
entity class and the person view in the postgres database.
Properties other than id that are inherited from Pelagos\Entity\Entity are mapped in
Pelagos.Entity.Entity.dcm.xml
-->

<doctrine-mapping xmlns="http://doctrine-project.org/schemas/orm/doctrine-mapping"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://doctrine-project.org/schemas/orm/doctrine-mapping
                        http://raw.github.com/doctrine/doctrine2/master/doctrine-mapping.xsd">

    <entity name="Pelagos\Entity\Person" table="person">

        <id name="id" column="person_number" type="integer">
            <generator strategy="SEQUENCE" />
            <sequence-generator sequence-name="seq_person_number" allocation-size="1" initial-value="1" />
        </id>

        <field name="firstName"          column="given_name"          type="string" />

        <field name="lastName"           column="surname"             type="string" />

        <field name="emailAddress"       column="email_address"       type="string" />

        <field name="phoneNumber"        column="phone_number"        type="string" nullable="true" />

        <field name="deliveryPoint"      column="delivery_point"      type="string" nullable="true" />

        <field name="city"               column="city"                type="string" nullable="true" />

        <field name="administrativeArea" column="administrative_area" type="string" nullable="true" />

        <field name="postalCode"         column="postal_code"         type="string" nullable="true" />

        <field name="country"            column="country"             type="string" nullable="true" />

        <field name="url"                column="website"             type="string" nullable="true" />

        <field name="organization"       column="organization"        type="string" nullable="true" />

        <field name="position"           column="position"            type="string" nullable="true" />

        <one-to-many field="personDataRepositories"     target-entity="PersonDataRepository"      mapped-by="person" />

        <one-to-many field="personFundingOrganizations" target-entity="PersonFundingOrganization" mapped-by="person" />

        <one-to-many field="personResearchGroups"       target-entity="PersonResearchGroup"       mapped-by="person" />
        
        <one-to-one  field="token"                      target-entity="PersonToken"               mapped-by="person" />

        <one-to-one  field="account"                    target-entity="Account"                   mapped-by="person" />

    </entity>

</doctrine-mapping>
