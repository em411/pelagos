#!/bin/bash

if [ ! -f .env.local ]; then
    echo ".env.local not found"
    exit
fi
# Manually parse DATABASE_URL from .env.local file

database_url=$(grep "^DATABASE_URL" ./.env.local)
IFS=':' read -ra database_url_parts <<< "$database_url"

# unused
dbtype=${database_url_parts[0]}
dbtype=${dbtype/database_url=/}

parameters__database_user=${database_url_parts[1]}
parameters__database_user=${parameters__database_user/\/\//}

dbpasshost=${database_url_parts[2]}
IFS='@' read -ra passhost_array <<< "$dbpasshost"
parameters__database_password=${passhost_array[0]}
parameters__database_host=${passhost_array[1]}

dbportname=${database_url_parts[3]}
IFS='/' read -ra partname_array <<< "$dbportname"
dbport=${partname_array[0]} # unused
parameters__database_name=${partname_array[1]}

export PGPASSWORD="$parameters__database_password"

echo "update person_data_repository set role_id = 1 where person_id in (select person_id from account where user_id in ('mvandeneijnden', 'mwilliamson', 'rrossi', 'bsigdel', 'wnichols', 'ppondicherry', 'lasirvadam' , 'undu', 'dlebel'))" | /usr/bin/psql -h $parameters__database_host -U $parameters__database_user $parameters__database_name || exit
echo "Bestowed DRPM superpowers to the usual suspects!"
